<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AICE Associate í•™ìŠµ ì§„ë„í‘œ</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
      background: #000000;
      color: #e0e0e0;
      padding: 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: #1a1a1a;
      border-radius: 15px;
      padding: 30px;
      border: 1px solid #333;
    }
    
    h1 {
      color: #ffffff;
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 4px solid #888;
      padding-bottom: 15px;
    }
    
    .stats {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 1fr;
      gap: 15px;
      margin-bottom: 30px;
    }
    
    @media (max-width: 768px) {
      .stats {
        grid-template-columns: 1fr;
      }
      .stat-box-main {
        grid-column: span 1;
      }
    }
    
    .stat-box {
      background: #2a2a2a;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #444;
      text-align: center;
    }
    
    .stat-box h3 {
      color: #888;
      font-size: 0.9em;
      margin-bottom: 10px;
    }
    
    .stat-box .value {
      color: #ffffff;
      font-size: 2em;
      font-weight: bold;
    }
    
    .stat-box .sub-value {
      color: #888;
      font-size: 0.85em;
      margin-top: 5px;
    }
    
    .progress-bar-large {
      width: 100%;
      height: 12px;
      background: #333;
      border-radius: 6px;
      overflow: hidden;
      margin-top: 15px;
    }
    
    .progress-fill-large {
      height: 100%;
      background: linear-gradient(90deg, #888 0%, #aaa 100%);
      transition: width 0.5s ease;
      border-radius: 6px;
    }
    
    .category {
      background: #2a2a2a;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid #444;
      border-left: 4px solid #888;
    }
    
    .category-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .category-header h2 {
      color: #ffffff;
      font-size: 1.4em;
    }
    
    .category-progress {
      color: #888;
      font-size: 0.9em;
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #333;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 15px;
    }
    
    .progress-fill {
      height: 100%;
      background: #888;
      transition: width 0.3s ease;
    }
    
    .item {
      display: flex;
      align-items: center;
      padding: 10px;
      margin: 5px 0;
      background: #1e1e1e;
      border-radius: 5px;
      border: 1px solid #333;
    }
    
    .item:hover {
      background: #252525;
    }
    
    .item input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin-right: 15px;
      cursor: pointer;
    }
    
    .item label {
      flex: 1;
      cursor: pointer;
      color: #e0e0e0;
    }
    
    .item.completed label {
      color: #888;
      text-decoration: line-through;
    }
    
    .time-input {
      width: 80px;
      padding: 5px;
      background: #1e1e1e;
      border: 1px solid #444;
      border-radius: 5px;
      color: #e0e0e0;
      text-align: center;
      margin-left: 10px;
    }
    
    .log-section {
      background: #2a2a2a;
      border-radius: 10px;
      padding: 20px;
      margin-top: 30px;
      border: 1px solid #444;
    }
    
    .log-section h2 {
      color: #ffffff;
      margin-bottom: 15px;
    }
    
    .log-input {
      width: 100%;
      padding: 10px;
      background: #1e1e1e;
      border: 1px solid #444;
      border-radius: 5px;
      color: #e0e0e0;
      margin-bottom: 10px;
      min-height: 100px;
      font-family: inherit;
    }
    
    .btn {
      background: #888;
      color: #ffffff;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1em;
      margin-right: 10px;
    }
    
    .btn:hover {
      background: #999;
    }
    
    .log-output {
      margin-top: 15px;
      padding: 15px;
      background: #1e1e1e;
      border-radius: 5px;
      border: 1px solid #444;
      white-space: pre-wrap;
      color: #e0e0e0;
      display: none;
    }
    
    .save-status {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #2a2a2a;
      color: #888;
      padding: 10px 20px;
      border-radius: 5px;
      border: 1px solid #444;
      font-size: 0.9em;
      display: none;
      z-index: 1000;
    }
    
    .save-status.saved {
      color: #888;
      border-color: #666;
    }
    
    .save-status.saving {
      color: #ffffff;
    }
    
    .btn-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    
    .btn-group-main {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 20px;
      margin-bottom: 15px;
    }
    
    .btn-group-sub {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #444;
    }
    
    .btn-secondary {
      background: #444;
    }
    
    .btn-secondary:hover {
      background: #555;
    }
    
    .path-selector {
      background: #1e1e1e;
      border: 1px solid #444;
      border-radius: 5px;
      padding: 10px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .path-selector button {
      background: #555;
      color: #ffffff;
      border: none;
      padding: 8px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9em;
      white-space: nowrap;
    }
    
    .path-selector button:hover {
      background: #666;
    }
    
    .path-display {
      flex: 1;
      color: #888;
      font-size: 0.85em;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .path-display.set {
      color: #aaa;
    }
    
    .path-info {
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #333;
      color: #666;
      font-size: 0.75em;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“Š AICE Associate í•™ìŠµ ì§„ë„í‘œ</h1>
    
    <div class="stats">
      <div class="stat-box stat-box-main">
        <h3>ì „ì²´ ì§„í–‰ë¥ </h3>
        <div class="value" id="totalProgress">0%</div>
        <div class="sub-value" id="totalTime">ì‹¤ì œ í•™ìŠµì‹œê°„: 0h</div>
        <div class="sub-value" id="totalPlannedTime">ì „ì²´ í•„ìš” í•™ìŠµì‹œê°„: 0h</div>
        <div class="progress-bar-large">
          <div class="progress-fill-large" id="totalProgressBar" style="width: 0%"></div>
        </div>
      </div>
      <div class="stat-box">
        <h3>ì™„ë£Œ í•­ëª©</h3>
        <div class="value" id="completedCount">0</div>
        <div class="sub-value" id="totalItems">/ 0ê°œ</div>
      </div>
      <div class="stat-box">
        <h3>ë‚¨ì€ í•­ëª©</h3>
        <div class="value" id="remainingCount">0</div>
        <div class="sub-value">ê°œ</div>
      </div>
      <div class="stat-box">
        <h3>í‰ê·  í•™ìŠµì‹œê°„</h3>
        <div class="value" id="avgTime">0h</div>
        <div class="sub-value">í•­ëª©ë‹¹</div>
      </div>
    </div>
    
    <div id="categories"></div>
    
    <div class="log-section">
      <h2>ğŸ“ ì˜¤ëŠ˜ì˜ í•™ìŠµ ë¡œê·¸</h2>
      
      <div class="path-selector">
        <button onclick="selectLogPath()">ğŸ“ ê²½ë¡œ ì„ íƒ</button>
        <div class="path-display" id="pathDisplay">ì €ì¥ ê²½ë¡œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</div>
      </div>
      
      <textarea class="log-input" id="dailyLog" placeholder="ì˜¤ëŠ˜ í•™ìŠµí•œ ë‚´ìš©ì„ ê¸°ë¡í•˜ì„¸ìš”..." oninput="autoSaveLog()"></textarea>
      
      <div class="btn-group-main">
        <button class="btn" onclick="saveLogToFile()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
        <button class="btn" onclick="loadLogFromFile()">ğŸ“‚ ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button class="btn" onclick="clearLog()">ì´ˆê¸°í™”</button>
        <button class="btn" onclick="saveAsImage()">ğŸ–¼ï¸ ì´ë¯¸ì§€ ì €ì¥</button>
      </div>
      
      <div class="btn-group-sub">
        <button class="btn btn-secondary" onclick="exportData()">ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
        <button class="btn btn-secondary" onclick="importData()">ë°ì´í„° ê°€ì ¸ì˜¤ê¸°</button>
      </div>
      
      <div class="path-info" id="pathInfo">ì €ì¥ ê²½ë¡œê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>
      
      <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleFileImport(event)">
      <input type="file" id="logFile" accept=".txt,.md,.json" style="display: none;" onchange="handleLogFileSelect(event)">
      
      <div class="log-output" id="logOutput"></div>
    </div>
    
    <div class="save-status" id="saveStatus">ì €ì¥ë¨</div>
  </div>
  
  <script>
    const curriculum = {
      "01_ê°œìš”": [
        { name: "01_ê°œìš”.md", time: 1 }
      ],
      "02_íŒŒì´ì¬ê¸°ì´ˆ": [
        { name: "02_01_ê¸°ë³¸ë¬¸ë²•.md", time: 2 },
        { name: "02_02_ìë£Œí˜•.md", time: 2 },
        { name: "02_03_ì¡°ê±´ë¬¸ë°˜ë³µë¬¸.md", time: 2 },
        { name: "02_04_í•¨ìˆ˜ëª¨ë“ˆ.md", time: 2 }
      ],
      "03_ë°ì´í„°ë¶„ì„": [
        { name: "03_01_Numpyê¸°ì´ˆ.md", time: 3 },
        { name: "03_02_Pandasê¸°ì´ˆ.md", time: 3 },
        { name: "03_03_ë°ì´í„°íƒìƒ‰.md", time: 2 }
      ],
      "04_ì „ì²˜ë¦¬": [
        { name: "04_01_ê²°ì¸¡ì¹˜ì²˜ë¦¬.md", time: 2 },
        { name: "04_02_ì´ìƒì¹˜ì²˜ë¦¬.md", time: 2 },
        { name: "04_03_ì¸ì½”ë”©.md", time: 2 },
        { name: "04_04_ìŠ¤ì¼€ì¼ë§.md", time: 2 }
      ],
      "05_ì‹œê°í™”": [
        { name: "05_01_Matplotlib.md", time: 2 },
        { name: "05_02_Seaborn.md", time: 2 }
      ],
      "06_ë¨¸ì‹ ëŸ¬ë‹": [
        { name: "06_01_ì§€ë„í•™ìŠµ.md", time: 3 },
        { name: "06_02_ë¹„ì§€ë„í•™ìŠµ.md", time: 2 },
        { name: "06_03_ëª¨ë¸í‰ê°€.md", time: 2 }
      ],
      "07_ê¸°ì¶œë¬¸ì œ": [
        { name: "07_01_ê¸°ì¶œìœ í˜•ë¶„ì„.md", time: 3 },
        { name: "07_02_ëª¨ì˜ê³ ì‚¬.md", time: 4 }
      ]
    };
    
    function loadProgress() {
      try {
        const saved = localStorage.getItem('aice_progress');
        if (!saved) return {};
        
        const parsed = JSON.parse(saved);
        // ë³´ì•ˆ: ë°ì´í„° êµ¬ì¡° ê²€ì¦
        if (typeof parsed !== 'object' || Array.isArray(parsed)) {
          console.warn('ì˜ëª»ëœ ë°ì´í„° í˜•ì‹, ì´ˆê¸°í™”í•©ë‹ˆë‹¤.');
          return {};
        }
        
        // ë³´ì•ˆ: ê° í•­ëª© ê²€ì¦ ë° ì •ë¦¬
        const validated = {};
        Object.keys(parsed).forEach(key => {
          if (key.startsWith('_')) {
            // ë‚´ë¶€ ë©”íƒ€ë°ì´í„°ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
            validated[key] = parsed[key];
            return;
          }
          
          const item = parsed[key];
          if (item && typeof item === 'object') {
            validated[key] = {
              checked: Boolean(item.checked),
              time: Math.max(0, Math.min(parseFloat(item.time) || 0, 20)), // 0-20ì‹œê°„ ì œí•œ
              date: item.date || null,
              updated: item.updated || null
            };
          }
        });
        
        return validated;
      } catch (e) {
        console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
        return {};
      }
    }
    
    function saveProgress(progress) {
      try {
        // ë³´ì•ˆ: ë°ì´í„° ê²€ì¦
        if (!progress || typeof progress !== 'object' || Array.isArray(progress)) {
          throw new Error('ì˜ëª»ëœ ë°ì´í„° í˜•ì‹');
        }
        
        // ë³´ì•ˆ: ë°ì´í„° í¬ê¸° ì œí•œ (5MB)
        const dataStr = JSON.stringify(progress);
        if (new Blob([dataStr]).size > 5 * 1024 * 1024) {
          throw new Error('ë°ì´í„° í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤');
        }
        
        localStorage.setItem('aice_progress', dataStr);
        showSaveStatus('saved');
        return true;
      } catch (e) {
        console.error('ì €ì¥ ì‹¤íŒ¨:', e);
        showSaveStatus('error');
        return false;
      }
    }
    
    function showSaveStatus(type) {
      const status = document.getElementById('saveStatus');
      status.style.display = 'block';
      
      if (type === 'saved') {
        status.textContent = 'âœ“ ì €ì¥ë¨';
        status.className = 'save-status saved';
        setTimeout(() => {
          status.style.display = 'none';
        }, 2000);
      } else if (type === 'saving') {
        status.textContent = 'ì €ì¥ ì¤‘...';
        status.className = 'save-status saving';
      } else if (type === 'error') {
        status.textContent = 'âœ— ì €ì¥ ì‹¤íŒ¨';
        status.className = 'save-status';
        status.style.color = '#ff6b6b';
        setTimeout(() => {
          status.style.display = 'none';
        }, 3000);
      }
    }
    
    // ë³´ì•ˆ: XSS ë°©ì§€ í…ìŠ¤íŠ¸ ì´ìŠ¤ì¼€ì´í”„
    function escapeHtml(text) {
      if (typeof text !== 'string') return String(text);
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function updateStats() {
      const progress = loadProgress();
      let total = 0;
      let completed = 0;
      let totalTime = 0;
      let totalPlannedTime = 0;
      
      Object.keys(curriculum).forEach(category => {
        curriculum[category].forEach(item => {
          total++;
          totalPlannedTime += item.time;
          const key = `${category}_${item.name}`;
          if (progress[key] && progress[key].checked) {
            completed++;
            const time = parseFloat(progress[key].time) || item.time;
            totalTime += Math.max(0, Math.min(time, 20)); // ë³´ì•ˆ: 0-20ì‹œê°„ ë²”ìœ„ ì œí•œ
          }
        });
      });
      
      const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
      const avgTime = completed > 0 ? (totalTime / completed).toFixed(1) : 0;
      
      // XSS ë°©ì§€: textContent ì‚¬ìš©
      const totalProgressEl = document.getElementById('totalProgress');
      const totalTimeEl = document.getElementById('totalTime');
      const totalPlannedTimeEl = document.getElementById('totalPlannedTime');
      const completedCountEl = document.getElementById('completedCount');
      const remainingCountEl = document.getElementById('remainingCount');
      const totalItemsEl = document.getElementById('totalItems');
      const avgTimeEl = document.getElementById('avgTime');
      const totalProgressBarEl = document.getElementById('totalProgressBar');
      
      if (totalProgressEl) totalProgressEl.textContent = percentage + '%';
      if (totalTimeEl) totalTimeEl.textContent = `ì‹¤ì œ í•™ìŠµì‹œê°„: ${totalTime.toFixed(1)}h`;
      if (totalPlannedTimeEl) totalPlannedTimeEl.textContent = `ì „ì²´ í•„ìš” í•™ìŠµì‹œê°„: ${totalPlannedTime.toFixed(1)}h`;
      if (completedCountEl) completedCountEl.textContent = completed;
      if (remainingCountEl) remainingCountEl.textContent = total - completed;
      if (totalItemsEl) totalItemsEl.textContent = `/ ${total}ê°œ`;
      if (avgTimeEl) avgTimeEl.textContent = avgTime + 'h';
      if (totalProgressBarEl) {
        const safePercentage = Math.max(0, Math.min(percentage, 100)); // 0-100% ë²”ìœ„ ì œí•œ
        totalProgressBarEl.style.width = safePercentage + '%';
      }
    }
    
    function renderCategories() {
      const progress = loadProgress();
      const container = document.getElementById('categories');
      container.innerHTML = '';
      
      Object.keys(curriculum).forEach(category => {
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'category';
        
        let categoryCompleted = 0;
        let categoryTotal = curriculum[category].length;
        
        const itemsHtml = curriculum[category].map((item, index) => {
          const key = `${category}_${item.name}`;
          const itemProgress = progress[key];
          const isCompleted = itemProgress && itemProgress.checked;
          
          if (isCompleted) categoryCompleted++;
          
          // ë³´ì•ˆ: XSS ë°©ì§€ - í‚¤ì™€ ì´ë¦„ ì´ìŠ¤ì¼€ì´í”„
          const safeKey = escapeHtml(key);
          const safeName = escapeHtml(item.name);
          const safeTime = Math.max(0, Math.min(parseFloat(itemProgress ? itemProgress.time : item.time) || 0, 20));
          const safeDefaultTime = Math.max(0, Math.min(parseFloat(item.time) || 0, 20));
          
          return `
            <div class="item ${isCompleted ? 'completed' : ''}">
              <input type="checkbox" id="${safeKey}" ${isCompleted ? 'checked' : ''} 
                     onchange="toggleItem('${safeKey}', ${safeDefaultTime})">
              <label for="${safeKey}">${safeName}</label>
              <input type="number" class="time-input" id="${safeKey}_time" 
                     value="${safeTime}" 
                     min="0" max="20" step="0.5"
                     onchange="updateTime('${safeKey}')" 
                     oninput="updateTime('${safeKey}')"
                     placeholder="ì‹œê°„">
            </div>
          `;
        }).join('');
        
        const categoryProgress = categoryTotal > 0 ? Math.round((categoryCompleted / categoryTotal) * 100) : 0;
        
        // ë³´ì•ˆ: XSS ë°©ì§€ - ì¹´í…Œê³ ë¦¬ ì´ë¦„ ì´ìŠ¤ì¼€ì´í”„
        const safeCategory = escapeHtml(category);
        const safeCategoryProgress = Math.max(0, Math.min(categoryProgress, 100));
        
        categoryDiv.innerHTML = `
          <div class="category-header">
            <h2>${safeCategory}</h2>
            <span class="category-progress">${categoryCompleted}/${categoryTotal} (${safeCategoryProgress}%)</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: ${safeCategoryProgress}%"></div>
          </div>
          ${itemsHtml}
        `;
        
        container.appendChild(categoryDiv);
      });
    }
    
    function toggleItem(key, defaultTime) {
      // ë³´ì•ˆ: í‚¤ ê²€ì¦
      if (!key || typeof key !== 'string' || key.length > 200) {
        console.error('ì˜ëª»ëœ í‚¤:', key);
        return;
      }
      
      // ë³´ì•ˆ: defaultTime ê²€ì¦
      defaultTime = Math.max(0, Math.min(parseFloat(defaultTime) || 0, 20));
      
      showSaveStatus('saving');
      const progress = loadProgress();
      const checkbox = document.getElementById(key);
      
      if (!checkbox) {
        console.error('ì²´í¬ë°•ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', key);
        return;
      }
      
      const item = checkbox.closest('.item');
      
      if (checkbox.checked) {
        progress[key] = {
          checked: true,
          time: defaultTime,
          date: new Date().toISOString()
        };
        if (item) item.classList.add('completed');
      } else {
        delete progress[key];
        if (item) item.classList.remove('completed');
      }
      
      saveProgress(progress);
      updateStats();
      // ì¹´í…Œê³ ë¦¬ ì¬ë Œë”ë§ì€ ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ì–´ ë¶€ë“œëŸ½ê²Œ ì²˜ë¦¬
      setTimeout(() => {
        renderCategories();
      }, 100);
    }
    
    function updateTime(key) {
      // ë³´ì•ˆ: í‚¤ ê²€ì¦
      if (!key || typeof key !== 'string' || key.length > 200) {
        console.error('ì˜ëª»ëœ í‚¤:', key);
        return;
      }
      
      showSaveStatus('saving');
      const progress = loadProgress();
      const timeInput = document.getElementById(key + '_time');
      
      if (!timeInput) {
        console.error('ì‹œê°„ ì…ë ¥ í•„ë“œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', key);
        return;
      }
      
      // ë³´ì•ˆ: ì…ë ¥ê°’ ê²€ì¦ ë° ì œí•œ (0-20ì‹œê°„)
      let time = parseFloat(timeInput.value) || 0;
      time = Math.max(0, Math.min(time, 20));
      timeInput.value = time; // ìœ íš¨í•œ ê°’ìœ¼ë¡œ ì¬ì„¤ì •
      
      if (progress[key]) {
        progress[key].time = time;
        progress[key].updated = new Date().toISOString();
        saveProgress(progress);
        updateStats();
      } else {
        // ì²´í¬ë˜ì§€ ì•Šì€ í•­ëª©ë„ ì‹œê°„ë§Œ ì €ì¥í•  ìˆ˜ ìˆë„ë¡
        progress[key] = {
          checked: false,
          time: time,
          updated: new Date().toISOString()
        };
        saveProgress(progress);
        updateStats();
      }
    }
    
    function autoSaveLog() {
      const logInput = document.getElementById('dailyLog');
      if (!logInput) return;
      
      // ë³´ì•ˆ: ë¡œê·¸ ê¸¸ì´ ì œí•œ (10,000ì)
      let log = logInput.value;
      if (log.length > 10000) {
        log = log.substring(0, 10000);
        logInput.value = log;
        alert('ë¡œê·¸ëŠ” ìµœëŒ€ 10,000ìê¹Œì§€ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
      }
      
      const today = new Date().toISOString().split('T')[0];
      const progress = loadProgress();
      
      if (!progress._logs) {
        progress._logs = {};
      }
      
      progress._logs[today] = log;
      saveProgress(progress);
    }
    
    function loadDailyLog() {
      const today = new Date().toISOString().split('T')[0];
      const progress = loadProgress();
      
      if (progress._logs && progress._logs[today]) {
        document.getElementById('dailyLog').value = progress._logs[today];
      }
    }
    
    function exportData() {
      const progress = loadProgress();
      const dataStr = JSON.stringify(progress, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `aice_progress_${new Date().toISOString().split('T')[0]}.json`;
      link.click();
      URL.revokeObjectURL(url);
      showSaveStatus('saved');
    }
    
    function importData() {
      document.getElementById('importFile').click();
    }
    
    function handleFileImport(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // ë³´ì•ˆ: íŒŒì¼ í¬ê¸° ì œí•œ (5MB)
      if (file.size > 5 * 1024 * 1024) {
        alert('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. (ìµœëŒ€ 5MB)');
        event.target.value = '';
        return;
      }
      
      // ë³´ì•ˆ: íŒŒì¼ íƒ€ì… ê²€ì¦
      if (file.type && !file.type.includes('json') && !file.name.endsWith('.json')) {
        alert('JSON íŒŒì¼ë§Œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        event.target.value = '';
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const imported = JSON.parse(e.target.result);
          
          // ë³´ì•ˆ: ë°ì´í„° êµ¬ì¡° ê²€ì¦
          if (typeof imported !== 'object' || Array.isArray(imported)) {
            throw new Error('ì˜ëª»ëœ ë°ì´í„° í˜•ì‹');
          }
          
          // ë³´ì•ˆ: ë°ì´í„° í¬ê¸° ì¬ê²€ì¦
          const dataStr = JSON.stringify(imported);
          if (new Blob([dataStr]).size > 5 * 1024 * 1024) {
            throw new Error('ë°ì´í„° í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤');
          }
          
          if (confirm('ê¸°ì¡´ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ ë°ì´í„°ë¡œ ë®ì–´ì“°ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            // ë³´ì•ˆ: ê²€ì¦ëœ ë°ì´í„°ë§Œ ì €ì¥
            const validated = loadProgress(); // ê²€ì¦ í•¨ìˆ˜ ì¬ì‚¬ìš©
            Object.keys(imported).forEach(key => {
              if (key.startsWith('_')) {
                validated[key] = imported[key];
              } else if (imported[key] && typeof imported[key] === 'object') {
                validated[key] = {
                  checked: Boolean(imported[key].checked),
                  time: Math.max(0, Math.min(parseFloat(imported[key].time) || 0, 20)),
                  date: imported[key].date || null,
                  updated: imported[key].updated || null
                };
              }
            });
            
            saveProgress(validated);
            updateStats();
            renderCategories();
            loadDailyLog();
            showSaveStatus('saved');
            alert('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.');
          }
        } catch (error) {
          alert('íŒŒì¼ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤: ' + error.message);
          console.error('Import error:', error);
        }
      };
      
      reader.onerror = function() {
        alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        event.target.value = '';
      };
      
      reader.readAsText(file);
      event.target.value = ''; // ê°™ì€ íŒŒì¼ ì¬ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡
    }
    
    function generateLog() {
      const log = document.getElementById('dailyLog').value;
      const date = new Date().toLocaleDateString('ko-KR');
      const progress = loadProgress();
      
      let completedToday = [];
      Object.keys(progress).forEach(key => {
        if (progress[key].date) {
          const itemDate = new Date(progress[key].date).toLocaleDateString('ko-KR');
          if (itemDate === date) {
            completedToday.push(key.split('_').slice(1).join('_'));
          }
        }
      });
      
      const output = `
ğŸ“… ${date} í•™ìŠµ ë¡œê·¸

âœ… ì™„ë£Œí•œ í•­ëª©:
${completedToday.length > 0 ? completedToday.map(item => `- ${item}`).join('\n') : '- ì—†ìŒ'}

ğŸ“ í•™ìŠµ ë‚´ìš©:
${log || '- ê¸°ë¡ ì—†ìŒ'}

ğŸ“Š ì˜¤ëŠ˜ì˜ í†µê³„:
- ì™„ë£Œ í•­ëª©: ${completedToday.length}ê°œ
- ì´ í•™ìŠµì‹œê°„: ${document.getElementById('totalTime').textContent}
      `.trim();
      
      const outputDiv = document.getElementById('logOutput');
      outputDiv.textContent = output;
      outputDiv.style.display = 'block';
    }
    
    function clearLog() {
      document.getElementById('dailyLog').value = '';
      document.getElementById('logOutput').style.display = 'none';
    }
    
    // HTMLì„ ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
    async function saveAsImage() {
      // html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ í™•ì¸
      if (typeof html2canvas === 'undefined') {
        alert('ì´ë¯¸ì§€ ë³€í™˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        return;
      }
      
      showSaveStatus('saving');
      
      try {
        const container = document.querySelector('.container');
        if (!container) {
          alert('ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          showSaveStatus('error');
          return;
        }
        
        // ì´ë¯¸ì§€ ë³€í™˜ ì˜µì…˜ (ì°¸ì¡° íŒŒì¼ì˜ ì„¤ì • ë°˜ì˜)
        const options = {
          backgroundColor: '#000000', // ë°°ê²½ìƒ‰
          scale: 2, // ê³ í•´ìƒë„ (ì°¸ì¡° íŒŒì¼ì˜ 2ë°° í¬ê¸° ì„¤ì • ë°˜ì˜)
          useCORS: true,
          logging: false,
          width: container.scrollWidth,
          height: container.scrollHeight,
          windowWidth: container.scrollWidth,
          windowHeight: container.scrollHeight
        };
        
        // HTMLì„ Canvasë¡œ ë³€í™˜
        const canvas = await html2canvas(container, options);
        
        // Canvasë¥¼ Blobìœ¼ë¡œ ë³€í™˜
        canvas.toBlob(function(blob) {
          if (!blob) {
            alert('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            showSaveStatus('error');
            return;
          }
          
          // íŒŒì¼ëª… ìƒì„± (í˜„ì¬ ë‚ ì§œ)
          const today = new Date().toISOString().split('T')[0];
          const fileName = `AICE_ì§„ë„í‘œ_${today}.png`;
          
          // File System Access APIë¥¼ ì‚¬ìš©í•œ ì €ì¥ (ê²½ë¡œê°€ ì„¤ì •ëœ ê²½ìš°)
          if (logPathHandle && 'showDirectoryPicker' in window) {
            saveImageToPath(blob, fileName);
          } else {
            // ë‹¤ìš´ë¡œë“œë¡œ ì €ì¥
            downloadImage(blob, fileName);
          }
        }, 'image/png', 1.0);
        
      } catch (error) {
        console.error('ì´ë¯¸ì§€ ì €ì¥ ì˜¤ë¥˜:', error);
        alert('ì´ë¯¸ì§€ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        showSaveStatus('error');
      }
    }
    
    // File System Access APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ ì €ì¥
    async function saveImageToPath(blob, fileName) {
      try {
        // "ê³µë¶€ê¸°ë¡ ì €ì •" í´ë” ì°¾ê¸° ë˜ëŠ” ìƒì„±
        let targetDirHandle = null;
        try {
          targetDirHandle = await logPathHandle.getDirectoryHandle('ê³µë¶€ê¸°ë¡ ì €ì •', { create: true });
        } catch (e) {
          console.error('í´ë” ì ‘ê·¼ ì‹¤íŒ¨:', e);
          alert('"ê³µë¶€ê¸°ë¡ ì €ì •" í´ë”ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œë¡œ ì €ì¥í•©ë‹ˆë‹¤.');
          downloadImage(blob, fileName);
          return;
        }
        
        // íŒŒì¼ ì €ì¥
        const fileHandle = await targetDirHandle.getFileHandle(fileName, { create: true });
        const writable = await fileHandle.createWritable();
        await writable.write(blob);
        await writable.close();
        
        showSaveStatus('saved');
        alert(`âœ… ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\níŒŒì¼ëª…: ${fileName}\nìœ„ì¹˜: ${logPathHandle.name || 'ì„ íƒí•œ í´ë”'}/ê³µë¶€ê¸°ë¡ ì €ì •`);
      } catch (error) {
        console.error('íŒŒì¼ ì €ì¥ ì‹¤íŒ¨:', error);
        if (error.name !== 'AbortError') {
          alert('íŒŒì¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œë¡œ ì €ì¥í•©ë‹ˆë‹¤.');
          downloadImage(blob, fileName);
        }
      }
    }
    
    // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ (í´ë°±)
    function downloadImage(blob, fileName) {
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = fileName;
      link.click();
      URL.revokeObjectURL(url);
      showSaveStatus('saved');
      alert(`âœ… ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\n\níŒŒì¼ëª…: ${fileName}\n\n"ê³µë¶€ê¸°ë¡ ì €ì •" í´ë”ì— ì €ì¥í•´ì£¼ì„¸ìš”.`);
    }
    
    // File System Access APIë¥¼ ì‚¬ìš©í•œ ë¡œê·¸ ì €ì¥
    let logDirectoryHandle = null;
    let logPathHandle = null; // ì„ íƒí•œ ê²½ë¡œ í•¸ë“¤
    
    // ê²½ë¡œ ì„ íƒ í•¨ìˆ˜
    async function selectLogPath() {
      if ('showDirectoryPicker' in window) {
        try {
          logPathHandle = await window.showDirectoryPicker({
            mode: 'readwrite',
            startIn: 'documents'
          });
          
          // ê²½ë¡œ í‘œì‹œ ì—…ë°ì´íŠ¸
          updatePathDisplay();
          showSaveStatus('saved');
          alert('âœ… ì €ì¥ ê²½ë¡œê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
        } catch (e) {
          if (e.name !== 'AbortError') {
            console.error('ê²½ë¡œ ì„ íƒ ì‹¤íŒ¨:', e);
            alert('ê²½ë¡œ ì„ íƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
          }
        }
      } else {
        alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ê²½ë¡œ ì„ íƒì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\në‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë©ë‹ˆë‹¤.');
      }
    }
    
    // ê²½ë¡œ í‘œì‹œ ì—…ë°ì´íŠ¸
    function updatePathDisplay() {
      const pathDisplay = document.getElementById('pathDisplay');
      const pathInfo = document.getElementById('pathInfo');
      
      if (logPathHandle) {
        // File System Access APIì—ì„œëŠ” í´ë” ì´ë¦„ë§Œ í‘œì‹œ ê°€ëŠ¥
        pathDisplay.textContent = `ì„ íƒëœ í´ë”: ${logPathHandle.name || 'í´ë”'}`;
        pathDisplay.classList.add('set');
        pathInfo.textContent = `ì €ì¥ ê²½ë¡œ: ${logPathHandle.name || 'í´ë”'} / ê³µë¶€ê¸°ë¡ ì €ì •`;
      } else {
        pathDisplay.textContent = 'ì €ì¥ ê²½ë¡œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
        pathDisplay.classList.remove('set');
        pathInfo.textContent = 'ì €ì¥ ê²½ë¡œê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤';
      }
    }
    
    async function saveLogToFile() {
      const logInput = document.getElementById('dailyLog');
      const log = logInput.value;
      
      if (!log.trim()) {
        alert('ì €ì¥í•  ë¡œê·¸ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }
      
      const today = new Date().toISOString().split('T')[0];
      const dateStr = new Date().toLocaleString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric' });
      const progress = loadProgress();
      
      // ì™„ë£Œí•œ í•­ëª© ìˆ˜ì§‘
      let completedToday = [];
      Object.keys(progress).forEach(key => {
        if (progress[key].date) {
          const itemDate = new Date(progress[key].date).toISOString().split('T')[0];
          if (itemDate === today) {
            completedToday.push(key.split('_').slice(1).join('_'));
          }
        }
      });
      
      // ë¡œê·¸ ë‚´ìš© ìƒì„±
      const logContent = `ğŸ“… ${dateStr} í•™ìŠµ ë¡œê·¸

âœ… ì™„ë£Œí•œ í•­ëª©:
${completedToday.length > 0 ? completedToday.map(item => `- ${item}`).join('\n') : '- ì—†ìŒ'}

ğŸ“ í•™ìŠµ ë‚´ìš©:
${log}

ğŸ“Š ì˜¤ëŠ˜ì˜ í†µê³„:
- ì™„ë£Œ í•­ëª©: ${completedToday.length}ê°œ
- ì´ í•™ìŠµì‹œê°„: ${document.getElementById('totalTime').textContent}

---
ìƒì„±ì¼ì‹œ: ${new Date().toLocaleString('ko-KR')}
`;
      
      const fileName = `í•™ìŠµë¡œê·¸_${today}.txt`;
      
      // ê²½ë¡œê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ê²½ë¡œ ì„ íƒ ìš”ì²­
      if (!logPathHandle) {
        if (confirm('ì €ì¥ ê²½ë¡œê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\nê²½ë¡œë¥¼ ì„ íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          await selectLogPath();
          if (!logPathHandle) {
            return; // ì‚¬ìš©ìê°€ ì·¨ì†Œí•œ ê²½ìš°
          }
        } else {
          // ê²½ë¡œ ì„ íƒì„ ì·¨ì†Œí•œ ê²½ìš° ë‹¤ìš´ë¡œë“œë¡œ ì €ì¥
          downloadLogFile(logContent, fileName);
          return;
        }
      }
      
      // File System Access API ì§€ì› í™•ì¸ (Chrome/Edge)
      if ('showDirectoryPicker' in window && logPathHandle) {
        try {
          // "ê³µë¶€ê¸°ë¡ ì €ì •" í´ë” ì°¾ê¸° ë˜ëŠ” ìƒì„±
          let targetDirHandle = null;
          try {
            targetDirHandle = await logPathHandle.getDirectoryHandle('ê³µë¶€ê¸°ë¡ ì €ì •', { create: true });
          } catch (e) {
            // í´ë” ì ‘ê·¼ ì‹¤íŒ¨ ì‹œ ë‹¤ìš´ë¡œë“œë¡œ í´ë°±
            console.error('í´ë” ì ‘ê·¼ ì‹¤íŒ¨:', e);
            alert('"ê³µë¶€ê¸°ë¡ ì €ì •" í´ë”ì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œë¡œ ì €ì¥í•©ë‹ˆë‹¤.');
            downloadLogFile(logContent, fileName);
            return;
          }
          
          // íŒŒì¼ ì €ì¥
          const fileHandle = await targetDirHandle.getFileHandle(fileName, { create: true });
          const writable = await fileHandle.createWritable();
          await writable.write(logContent);
          await writable.close();
          
          showSaveStatus('saved');
          alert(`âœ… ë¡œê·¸ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\níŒŒì¼ëª…: ${fileName}\nìœ„ì¹˜: ${logPathHandle.name || 'ì„ íƒí•œ í´ë”'}/ê³µë¶€ê¸°ë¡ ì €ì •`);
        } catch (error) {
          console.error('íŒŒì¼ ì €ì¥ ì‹¤íŒ¨:', error);
          if (error.name !== 'AbortError') {
            alert('íŒŒì¼ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ìš´ë¡œë“œë¡œ ì €ì¥í•©ë‹ˆë‹¤.');
            downloadLogFile(logContent, fileName);
          }
        }
      } else {
        // File System Access APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì € (Firefox, Safari ë“±)
        downloadLogFile(logContent, fileName);
      }
    }
    
    // ë‹¤ìš´ë¡œë“œë¡œ ë¡œê·¸ ì €ì¥ (í´ë°±)
    function downloadLogFile(content, fileName) {
      const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = fileName;
      link.click();
      URL.revokeObjectURL(url);
      showSaveStatus('saved');
      alert(`ë¡œê·¸ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\níŒŒì¼ëª…: ${fileName}\n\n"ê³µë¶€ê¸°ë¡ ì €ì •" í´ë”ì— ì €ì¥í•´ì£¼ì„¸ìš”.`);
    }
    
    // ë¡œê·¸ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadLogFromFile() {
      // ê²½ë¡œê°€ ì„¤ì •ëœ ê²½ìš° í•´ë‹¹ ê²½ë¡œì—ì„œ íŒŒì¼ ì„ íƒ
      if (logPathHandle && 'showDirectoryPicker' in window) {
        try {
          // "ê³µë¶€ê¸°ë¡ ì €ì •" í´ë” ì ‘ê·¼
          let targetDirHandle = null;
          try {
            targetDirHandle = await logPathHandle.getDirectoryHandle('ê³µë¶€ê¸°ë¡ ì €ì •');
          } catch (e) {
            alert('"ê³µë¶€ê¸°ë¡ ì €ì •" í´ë”ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\níŒŒì¼ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.');
            document.getElementById('logFile').click();
            return;
          }
          
          // íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
          const files = [];
          for await (const [name, handle] of targetDirHandle.entries()) {
            if (handle.kind === 'file' && (name.endsWith('.txt') || name.endsWith('.md'))) {
              files.push({ name, handle });
            }
          }
          
          if (files.length === 0) {
            alert('ì €ì¥ëœ ë¡œê·¸ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.');
            return;
          }
          
          // íŒŒì¼ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ (ê°„ë‹¨í•œ ë°©ë²•ìœ¼ë¡œëŠ” íŒŒì¼ ì„ íƒ ë‹¤ì´ì–¼ë¡œê·¸ ì‚¬ìš©)
          // File System Access APIì˜ íŒŒì¼ ì„ íƒì€ ë³µì¡í•˜ë¯€ë¡œ ì¼ë°˜ íŒŒì¼ ì„ íƒ ì‚¬ìš©
          document.getElementById('logFile').click();
        } catch (e) {
          console.error('í´ë” ì ‘ê·¼ ì‹¤íŒ¨:', e);
          document.getElementById('logFile').click();
        }
      } else {
        // ê²½ë¡œê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ê±°ë‚˜ APIë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” ê²½ìš° ì¼ë°˜ íŒŒì¼ ì„ íƒ
        document.getElementById('logFile').click();
      }
    }
    
    function handleLogFileSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // ë³´ì•ˆ: íŒŒì¼ í¬ê¸° ì œí•œ (1MB)
      if (file.size > 1 * 1024 * 1024) {
        alert('íŒŒì¼ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. (ìµœëŒ€ 1MB)');
        event.target.value = '';
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const content = e.target.result;
          
          // ë¡œê·¸ ë‚´ìš© íŒŒì‹± (ê°„ë‹¨í•œ í˜•ì‹)
          // "ğŸ“ í•™ìŠµ ë‚´ìš©:" ì„¹ì…˜ ì¶”ì¶œ
          const contentMatch = content.match(/ğŸ“ í•™ìŠµ ë‚´ìš©:\s*\n([\s\S]*?)(?=\nğŸ“Š|\n---|$)/);
          if (contentMatch) {
            const logContent = contentMatch[1].trim();
            document.getElementById('dailyLog').value = logContent;
            showSaveStatus('saved');
            
            // ë¡œê·¸ ì¶œë ¥ ì˜ì—­ì— ì „ì²´ ë‚´ìš© í‘œì‹œ
            const outputDiv = document.getElementById('logOutput');
            outputDiv.textContent = content;
            outputDiv.style.display = 'block';
            
            alert(`âœ… ë¡œê·¸ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!\n\níŒŒì¼ëª…: ${file.name}`);
          } else {
            // í˜•ì‹ì´ ë‹¤ë¥¸ ê²½ìš° ì „ì²´ ë‚´ìš© í‘œì‹œ
            document.getElementById('dailyLog').value = content;
            showSaveStatus('saved');
            
            // ë¡œê·¸ ì¶œë ¥ ì˜ì—­ì—ë„ í‘œì‹œ
            const outputDiv = document.getElementById('logOutput');
            outputDiv.textContent = content;
            outputDiv.style.display = 'block';
            
            alert(`âœ… ë¡œê·¸ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!\n\níŒŒì¼ëª…: ${file.name}\n(í˜•ì‹ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤)`);
          }
        } catch (error) {
          alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
          console.error('Log file read error:', error);
        }
      };
      
      reader.onerror = function() {
        alert('íŒŒì¼ì„ ì½ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        event.target.value = '';
      };
      
      reader.readAsText(file, 'UTF-8');
      event.target.value = ''; // ê°™ì€ íŒŒì¼ ì¬ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¼ì¼ ë¡œê·¸ ìë™ ë¡œë“œ ë° ê²½ë¡œ í‘œì‹œ ì—…ë°ì´íŠ¸
    window.addEventListener('DOMContentLoaded', function() {
      loadDailyLog();
      updatePathDisplay();
    });
    
    // ì£¼ê¸°ì ìœ¼ë¡œ ìë™ ì €ì¥ (10ì´ˆë§ˆë‹¤) - ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ
    let lastProgressHash = '';
    setInterval(function() {
      const progress = loadProgress();
      const currentHash = JSON.stringify(progress);
      if (currentHash !== lastProgressHash) {
        lastProgressHash = currentHash;
        // ì €ì¥ ìƒíƒœ í‘œì‹œ ì—†ì´ ì¡°ìš©íˆ ì €ì¥
        try {
          localStorage.setItem('aice_progress', JSON.stringify(progress));
        } catch (e) {
          console.error('ìë™ ì €ì¥ ì‹¤íŒ¨:', e);
        }
      }
    }, 10000);
    
    // í˜ì´ì§€ ë– ë‚˜ê¸° ì „ ìë™ ì €ì¥
    window.addEventListener('beforeunload', function() {
      const progress = loadProgress();
      saveProgress(progress);
    });
    
    // ì´ˆê¸°í™”
    const initialProgress = loadProgress();
    lastProgressHash = JSON.stringify(initialProgress);
    updateStats();
    renderCategories();
  </script>
</body>
</html>

