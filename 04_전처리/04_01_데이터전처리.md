# 04-01. 데이터 전처리

## 📋 목차

- [1. 데이터 전처리란?](#1-데이터-전처리란)
- [2. 결측치 처리](#2-결측치-처리)
- [3. 이상치 처리](#3-이상치-처리)
- [4. 데이터 변환](#4-데이터-변환)
- [5. 중복 데이터 처리](#5-중복-데이터-처리)
- [6. 실습](#6-실습)
- [7. 요약](#7-요약)

---

## 1. 데이터 전처리란?

**데이터 전처리**는 머신러닝 모델에 데이터를 입력하기 전에 데이터를 정제하고 변환하는 과정입니다. 실제 데이터는 결측치, 이상치, 불일치 등이 있어 전처리가 필수적입니다.

### 1.1 전처리의 중요성

- **모델 성능 향상**: 깨끗한 데이터는 더 나은 예측 결과를 만듦
- **오류 방지**: 결측치나 이상치로 인한 오류 예방
- **데이터 품질**: 일관성 있고 신뢰할 수 있는 데이터 확보

---

## 2. 결측치 처리

### 2.1 결측치 확인

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({
    '이름': ['홍길동', '김철수', '이영희', '박민수'],
    '나이': [25, np.nan, 28, 35],
    '급여': [3000, 4000, np.nan, 5000]
})

# 결측치 확인
print(df.isna())        # 결측치 여부 (True/False)
print(df.isnull())      # isna()와 동일
print(df.isna().sum())  # 열별 결측치 개수
print(df.isna().sum().sum())  # 전체 결측치 개수
```

### 2.2 결측치 제거

```python
# 행 제거
df_dropna = df.dropna()              # 결측치가 있는 행 모두 제거
df_dropna = df.dropna(how='all')     # 모든 값이 결측치인 행만 제거
df_dropna = df.dropna(subset=['나이'])  # 특정 열의 결측치만 제거

# 열 제거
df_dropna_col = df.dropna(axis=1)    # 결측치가 있는 열 제거
```

### 2.3 결측치 채우기

```python
# 특정 값으로 채우기
df_fill = df.fillna(0)                    # 0으로 채우기
df_fill = df.fillna({'나이': 0, '급여': 1000})  # 열별로 다른 값

# 통계값으로 채우기
df_fill = df.fillna(df.mean())            # 평균값으로 채우기
df_fill = df['나이'].fillna(df['나이'].mean())  # 특정 열만
df_fill = df.fillna(df.median())          # 중앙값으로 채우기
df_fill = df.fillna(df.mode().iloc[0])    # 최빈값으로 채우기

# 앞/뒤 값으로 채우기 (시계열 데이터)
df_fill = df.fillna(method='ffill')       # 앞 값으로 채우기
df_fill = df.fillna(method='bfill')       # 뒤 값으로 채우기
```

---

## 3. 이상치 처리

### 3.1 이상치 탐지

```python
import pandas as pd
import numpy as np

df = pd.DataFrame({
    '나이': [25, 30, 28, 200, 35, 27],  # 200은 이상치
    '키': [175, 180, 165, 178, 300, 170]  # 300은 이상치
})

# IQR 방법으로 이상치 탐지
Q1 = df['나이'].quantile(0.25)
Q3 = df['나이'].quantile(0.75)
IQR = Q3 - Q1
lower_bound = Q1 - 1.5 * IQR
upper_bound = Q3 + 1.5 * IQR

outliers = df[(df['나이'] < lower_bound) | (df['나이'] > upper_bound)]
print(outliers)

# Z-score 방법
from scipy import stats
z_scores = np.abs(stats.zscore(df['나이']))
outliers = df[z_scores > 3]  # Z-score가 3보다 큰 값
```

### 3.2 이상치 처리

```python
# 이상치 제거
df_clean = df[(df['나이'] >= lower_bound) & (df['나이'] <= upper_bound)]

# 이상치를 경계값으로 대체
df['나이'] = df['나이'].clip(lower=lower_bound, upper=upper_bound)

# 이상치를 중앙값으로 대체
median_value = df['나이'].median()
df.loc[df['나이'] > upper_bound, '나이'] = median_value
```

---

## 4. 데이터 변환

### 4.1 데이터 타입 변환

```python
import pandas as pd

df = pd.DataFrame({
    '나이': ['25', '30', '28'],  # 문자열
    '급여': ['3000', '4000', '5000']
})

# 타입 변환
df['나이'] = df['나이'].astype(int)
df['급여'] = pd.to_numeric(df['급여'])

# 날짜 변환
df['날짜'] = pd.to_datetime(['2023-01-01', '2023-02-01', '2023-03-01'])
```

### 4.2 범주형 데이터 인코딩

```python
import pandas as pd

df = pd.DataFrame({
    '직업': ['학생', '회사원', '교사', '회사원']
})

# 원-핫 인코딩 (One-Hot Encoding)
df_encoded = pd.get_dummies(df, columns=['직업'])
print(df_encoded)

# 라벨 인코딩
from sklearn.preprocessing import LabelEncoder
le = LabelEncoder()
df['직업_encoded'] = le.fit_transform(df['직업'])
```

### 4.3 정규화 및 표준화

```python
from sklearn.preprocessing import MinMaxScaler, StandardScaler

# Min-Max 정규화 (0~1 사이로 변환)
scaler_minmax = MinMaxScaler()
df_normalized = scaler_minmax.fit_transform(df[['나이', '급여']])

# 표준화 (평균 0, 표준편차 1)
scaler_std = StandardScaler()
df_standardized = scaler_std.fit_transform(df[['나이', '급여']])
```

---

## 5. 중복 데이터 처리

### 5.1 중복 확인 및 제거

```python
import pandas as pd

df = pd.DataFrame({
    '이름': ['홍길동', '김철수', '홍길동', '이영희'],
    '나이': [25, 30, 25, 28]
})

# 중복 확인
print(df.duplicated())        # 중복 행 여부
print(df.duplicated().sum())  # 중복 행 개수

# 중복 제거
df_unique = df.drop_duplicates()                    # 모든 열 기준
df_unique = df.drop_duplicates(subset=['이름'])     # 특정 열 기준
df_unique = df.drop_duplicates(keep='first')        # 첫 번째 유지
df_unique = df.drop_duplicates(keep='last')         # 마지막 유지
```

---

## 6. 실습

### 실습: 데이터 전처리 종합

```python
import pandas as pd
import numpy as np

# 샘플 데이터 생성
data = {
    '이름': ['홍길동', '김철수', '이영희', '박민수', '최지영', '홍길동'],
    '나이': [25, np.nan, 28, 200, 35, 25],
    '급여': [3000, 4000, np.nan, 5000, 4500, 3000],
    '직업': ['학생', '회사원', '교사', '회사원', '학생', '학생']
}
df = pd.DataFrame(data)

print("원본 데이터:")
print(df)
print("\n결측치 개수:")
print(df.isna().sum())

# 1. 결측치 처리
df['나이'] = df['나이'].fillna(df['나이'].median())
df['급여'] = df['급여'].fillna(df['급여'].mean())

# 2. 이상치 처리 (나이)
Q1 = df['나이'].quantile(0.25)
Q3 = df['나이'].quantile(0.75)
IQR = Q3 - Q1
df['나이'] = df['나이'].clip(lower=Q1-1.5*IQR, upper=Q3+1.5*IQR)

# 3. 중복 제거
df = df.drop_duplicates(subset=['이름'], keep='first')

# 4. 원-핫 인코딩
df = pd.get_dummies(df, columns=['직업'])

print("\n전처리 후 데이터:")
print(df)
```

---

## 7. 요약

### 핵심 정리

1. **결측치 처리**: `isna()`, `dropna()`, `fillna()` 사용
2. **이상치 처리**: IQR, Z-score 방법으로 탐지 후 제거 또는 대체
3. **데이터 변환**: 타입 변환, 인코딩, 정규화/표준화
4. **중복 제거**: `drop_duplicates()` 사용

### AICE 실전 팁

- **결측치**: 데이터 특성에 따라 제거 또는 채우기 선택
- **이상치**: 도메인 지식을 활용하여 판단
- **인코딩**: 범주형 데이터는 원-핫 인코딩이 일반적
- **정규화**: 머신러닝 모델 전에 필수

---

## ✅ 체크리스트

- [ ] 결측치 확인 및 처리 방법 이해
- [ ] 이상치 탐지 및 처리 방법 숙지
- [ ] 데이터 타입 변환 방법 이해
- [ ] 범주형 데이터 인코딩 방법 숙지
- [ ] 중복 데이터 처리 방법 이해
- [ ] 실습 코드 작성 및 실행 완료

---

## 📚 참고 자료

- [Pandas 데이터 전처리](https://pandas.pydata.org/docs/user_guide/missing_data.html)
- [Scikit-learn 전처리](https://scikit-learn.org/stable/modules/preprocessing.html)

---

**작성일**: 2025-11-19  
**이전 학습**: [03_02_Pandas기초](../03_데이터분석/03_02_Pandas기초.md)  
**다음 학습**: [05_01_데이터시각화](../05_시각화/05_01_데이터시각화.md)

